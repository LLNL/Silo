name: Basic

on:
  push:
    branches: ["mcm86-30jul24-gh-actions-ci"]
  pull_request:
    branches: [ "main" ]
    
jobs:
  build:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Probe system
      run: |
        pwd
        ls
    
    - name: Install HDF5
      run: |
        wget https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.14/hdf5-1.14.4/bin/unix/hdf5-1.14.4-3-ubuntu-2204_gcc.tar.gz
        mkdir hdf5-1.14.4-3
        tar -xf hdf5-1.14.4-3-ubuntu-2204_gcc.tar.gz
        tar -xf hdf5/HDF5-1.14.4.3-Linux.tar.gz --strip-components=4 -C hdf5-1.14.4-3
        rm -rf hdf5
        pwd
        ls
        ls hdf5-1.14.4-3
        ./hdf5-1.14.4-3/bin/h5ls --help

    - name: Build and Check Silo
      run: |
        set +e
        mkdir build
        cd build
        ../configure --with-hdf5=`pwd`/../hdf5-1.14.4-3/include,`pwd`/../hdf5-1.14.4-3/lib --enable-pythonmodule --disable-fortran --prefix=`pwd`/myinstall
        cat config.log
        make -j 8 install
        make -j 8 check
        ./tests/dbversion
        ./tests/onehex DB_HDF5
